#include "../commun/td3.h"


extern Handler HANDLER_TABLE[PALETTE_SIZE];
extern char ALPHABET_PALETTE[PALETTE_SIZE];
extern char* NOM_FICHIERS[PALETTE_SIZE];

//choix de la palette a utiliser
char* palette_courante = ALPHABET_PALETTE;


void codage(int in)
{
	unsigned char cpt=0;
	char c; //buffer 
	while(read(in,&c,1)>0){
		c = tolower(c);
		
		int out = open(get_filename_for_char(c),O_CREAT | O_WRONLY | O_APPEND,0777);
		write(out,&cpt,1);
		close(out);
		cpt++;
	}


}


void decodage(int out)
{
	//system("ls *.in>list.txt");
	//int desc_sortie = open("list.txt",O_RDONLY, 0777);
	
	int fe;
	unsigned char buffer1;
	
	for(int i=0;i<PALETTE_SIZE;i++){
		fe = open(NOM_FICHIERS[i],O_RDONLY,0777);

		while(read(fe,&buffer1,1)>0){
			lseek(out,buffer1,SEEK_SET);
			HANDLER_TABLE[i](out);
		}
		close(fe);
	}
	close(out);
	
	
}
